--server
local socket = require("socket")
local server = assert(socket.bind("*",0))
local ip, port = server:getsockname()
print("Please telnet to localhost on port " .. port)
print("After connecting, you have 10s to enter a line to be echoed")
while 1 do
  local client = server:accept()
  client:settimeout(10)
  local line, err = client:receive()
  if not err then client:send(line .. "\n") end
  client:close()
end

--client
local host, port = "10.115.65.93", 8080
local socket = require("socket")
local tcp = assert(socket.tcp())

tcp:connect(host,port);
tcp:send("hello world\n");

while true do
  local s, status, partial = tcp:receive()
  print(s or partial)
  if status == "closed" then break end
end
tcp:close()
